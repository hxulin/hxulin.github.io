<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>深入解析String#intern（转） | 黄小鱼的个人博客</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/img/favicon.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/md5-js@0.0.3/md5.min.js"></script>
    <script type="text/javascript" src="https://hm.baidu.com/hm.js?7416f9f03c8c29e159637a2b26fa47ac"></script>
    <meta name="description" content="日常笔记，个人随笔">
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/css/0.styles.29c9ccc7.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/app.d0033b28.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/3.fef87ffa.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/4.1bcccd14.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/20.c035d260.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/9.41320d8a.js" as="script"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/10.ea855e90.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/11.8f50bd74.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/12.54768731.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/13.d9c0b472.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/14.de1f6da7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/15.6f5762d6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/16.ed9efa2a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/17.d7bc9ceb.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/18.0353e3a7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/19.94865ec7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/2.b9637e6e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/21.8fd1ee73.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/22.bf7d5ed8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/23.3d356ed7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/24.8e609a87.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/25.cc86d137.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/26.963277ed.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/27.70f0f019.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/28.76476a23.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/29.b7d62e24.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/30.93b2e53a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/31.f34e24d2.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/32.c7203841.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/33.ba9abd55.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/34.90c985e1.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/35.0e9a268c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/36.e3540f48.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/37.6360b3df.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/38.addd854d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/39.da52fe73.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/40.8d793a32.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/41.a92aa77d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/42.a05b8f99.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/43.5de84868.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/44.47f5735f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/45.de2a8cbf.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/46.073c7d7a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/47.bf3aabf6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/48.8f215051.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/49.327907ca.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/5.494a177a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/6.cc18b175.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/7.aa172dc1.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/8.a4d12f52.js">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/css/0.styles.29c9ccc7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active no-logo home-link"><!----> <span class="site-name">黄小鱼的个人博客</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/" class="router-link-active">
          首页
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/guide/">
          文章
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/tools/">
          工具
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/message/">
          留言
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <a href="https://github.com/hxulin/my-blog" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><a href="/guide/" title="快速索引" class="sidebar-link">快速索引</a></li><li><a href="/2022/01/04/mysql-sort-move-up-and-move-down/" title="MySQL 中自定义排序，上移、下移功能的设计" class="sidebar-link">MySQL 中自定义排序，上移、下移功能的设计</a></li><li><a href="/2021/11/29/logic-delete-and-unique-key/" title="逻辑删除和唯一索引" class="sidebar-link">逻辑删除和唯一索引</a></li><li><a href="/2021/07/17/use-acme-sh-apply-ssl-certificate/" title="使用 acme.sh 申请免费自动续期的 SSL 证书" class="sidebar-link">使用 acme.sh 申请免费自动续期的 SSL 证书</a></li><li><a href="/2021/07/15/mysql-procedure-samples/" title="一个 MySQL 存储过程的样例，备查" class="sidebar-link">一个 MySQL 存储过程的样例，备查</a></li><li><a href="/2021/07/04/java8-date-time-processing/" title="Java8 之日期处理，工作必用" class="sidebar-link">Java8 之日期处理，工作必用</a></li><li><a href="/2021/05/12/vmware-centos7-boot-optimization/" title="VMware 安装 CentOS7 开机优化" class="sidebar-link">VMware 安装 CentOS7 开机优化</a></li><li><a href="/2021/05/07/idea-hot-key-ctrl-shift-f-invalid/" title="IDEA 快捷键 Ctrl+Shift+F 失效问题" class="sidebar-link">IDEA 快捷键 Ctrl+Shift+F 失效问题</a></li><li><a href="/2021/04/13/css3-flex-horizontal-vertical-center/" title="CSS3 flex 布局水平垂直居中" class="sidebar-link">CSS3 flex 布局水平垂直居中</a></li><li><a href="/2021/04/11/vi-common-commands-summary/" title="VI 常用命令总结" class="sidebar-link">VI 常用命令总结</a></li><li><a href="/2021/04/11/mongodb-replica-set-deploy/" title="MongoDB 副本集集群部署" class="sidebar-link">MongoDB 副本集集群部署</a></li><li><a href="/2021/04/10/nginx-compile-install-with-https/" title="Nginx 编译安装，支持 HTTPS" class="sidebar-link">Nginx 编译安装，支持 HTTPS</a></li><li><a href="/2021/03/28/gluster-file-system-install/" title="Gluster 分布式存储系统快速安装步骤" class="sidebar-link">Gluster 分布式存储系统快速安装步骤</a></li><li><a href="/2021/03/27/centos7-turn-off-selinux-firewall/" title="CentOS7 关闭 selinux、防火墙" class="sidebar-link">CentOS7 关闭 selinux、防火墙</a></li><li><a href="/2021/03/27/centos7-set-timezone-hostname-hosts/" title="CentOS7 集群环境设置时区、主机名，配置 hosts 文件" class="sidebar-link">CentOS7 集群环境设置时区、主机名，配置 hosts 文件</a></li><li><a href="/2021/03/22/centos7-system-version-cpu-memory-disk/" title="查看系统版本，CPU核数，内存、磁盘使用情况" class="sidebar-link">查看系统版本，CPU核数，内存、磁盘使用情况</a></li><li><a href="/2019/03/30/spring-data-jpa-result-set-mapping/" title="Spring Data JPA使用原生SQL做复杂查询，结果封装到自定义实体" class="sidebar-link">Spring Data JPA使用原生SQL做复杂查询，结果封装到自定义实体</a></li><li><a href="/2019/01/15/spring-ioc-container/" title="Spring IoC容器" class="sidebar-link">Spring IoC容器</a></li><li><a href="/2019/01/12/jquery-common-function/" title="jQuery一些常用函数的小结" class="sidebar-link">jQuery一些常用函数的小结</a></li><li><a href="/2018/12/29/rabbitmq-common-commands/" title="RabbitMQ常用命令总结" class="sidebar-link">RabbitMQ常用命令总结</a></li><li><a href="/2018/12/22/in-depth-understanding-string-intern/" aria-current="page" title="深入解析String#intern（转）" class="active sidebar-link">深入解析String#intern（转）</a></li><li><a href="/2018/12/17/equals-hashcode-method/" title="Java 中的 equals() 和 hashCode() 方法" class="sidebar-link">Java 中的 equals() 和 hashCode() 方法</a></li><li><a href="/2018/12/08/encryption-rsa/" title="Java 和 js 互加解密(2) — RSA非对称加密算法" class="sidebar-link">Java 和 js 互加解密(2) — RSA非对称加密算法</a></li><li><a href="/2018/12/02/encryption-aes/" title="Java 和 js 互加解密(1) — AES对称加密算法" class="sidebar-link">Java 和 js 互加解密(1) — AES对称加密算法</a></li><li><a href="/2018/11/25/batch-package/" title="批量复制 War/Jar 文件" class="sidebar-link">批量复制 War/Jar 文件</a></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="深入解析string-intern-转"><a href="#深入解析string-intern-转" class="header-anchor">#</a> 深入解析String#intern（转）</h1> <div class="post-meta" data-v-b624ef2c><i aria-label="icon: calendar" class="anticon anticon-calendar" data-v-b624ef2c><svg viewBox="64 64 896 896" focusable="false" data-icon="calendar" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M880 184H712v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H144c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V216c0-17.7-14.3-32-32-32zm-40 656H184V460h656v380zM184 392V256h128v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h256v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h128v136H184z"></path></svg></i> <span class="date" data-v-b624ef2c>发表于 2018-12-22</span></div> <h2 id="引言"><a href="#引言" class="header-anchor">#</a> 引言</h2> <p>在 JAVA 语言中有 8 中基本类型和一种比较特殊的类型<code>String</code>。这些类型为了使他们在运行过程中速度更快，更节省内存，都提供了一种常量池的概念。常量池就类似一个JAVA系统级别提供的缓存。</p> <p>8 种基本类型的常量池都是系统协调的，<code>String</code>类型的常量池比较特殊。它的主要使用方法有两种：</p> <ul><li>直接使用双引号声明出来的<code>String</code>对象会直接存储在常量池中。</li> <li>如果不是用双引号声明的<code>String</code>对象，可以使用<code>String</code>提供的<code>intern</code>方法。intern 方法会从字符串常量池中查询当前字符串是否存在，若不存在就会将当前字符串放入常量池中。</li></ul> <p>接下来我们主要来谈一下<code>String#intern</code>方法。</p> <h2 id="一-intern-的实现原理"><a href="#一-intern-的实现原理" class="header-anchor">#</a> 一, intern 的实现原理</h2> <p>首先深入看一下它的实现原理。</p> <h3 id="_1-java-代码"><a href="#_1-java-代码" class="header-anchor">#</a> 1，JAVA 代码</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/** 
 * Returns a canonical representation for the string object. 
 * &lt;p&gt; 
 * A pool of strings, initially empty, is maintained privately by the 
 * class &lt;code&gt;String&lt;/code&gt;. 
 * &lt;p&gt; 
 * When the intern method is invoked, if the pool already contains a 
 * string equal to this &lt;code&gt;String&lt;/code&gt; object as determined by 
 * the {@link #equals(Object)} method, then the string from the pool is 
 * returned. Otherwise, this &lt;code&gt;String&lt;/code&gt; object is added to the 
 * pool and a reference to this &lt;code&gt;String&lt;/code&gt; object is returned. 
 * &lt;p&gt; 
 * It follows that for any two strings &lt;code&gt;s&lt;/code&gt; and &lt;code&gt;t&lt;/code&gt;, 
 * &lt;code&gt;s.intern()&amp;nbsp;==&amp;nbsp;t.intern()&lt;/code&gt; is &lt;code&gt;true&lt;/code&gt; 
 * if and only if &lt;code&gt;s.equals(t)&lt;/code&gt; is &lt;code&gt;true&lt;/code&gt;. 
 * &lt;p&gt; 
 * All literal strings and string-valued constant expressions are 
 * interned. String literals are defined in section 3.10.5 of the 
 * &lt;cite&gt;The Java&amp;trade; Language Specification&lt;/cite&gt;. 
 * 
 * @return  a string that has the same contents as this string, but is 
 *          guaranteed to be from a pool of unique strings. 
 */</span>  
<span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token class-name">String</span> <span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>String#intern</code>方法中看到，这个方法是一个 native 的方法，但注释写的非常明了。“如果常量池中存在当前字符串, 就会直接返回当前字符串. 如果常量池中没有此字符串, 会将此字符串放入常量池中后, 再返回”。</p> <h3 id="_2-native-代码"><a href="#_2-native-代码" class="header-anchor">#</a> 2，native 代码</h3> <p>在 jdk7后，oracle 接管了 JAVA 的源码后就不对外开放了，根据 jdk 的主要开发人员声明 openJdk7 和 jdk7 使用的是同一分主代码，只是分支代码会有些许的变动。所以可以直接跟踪 openJdk7 的源码来探究 intern 的实现。</p> <p>####native实现代码:
\openjdk7\jdk\src\share\native\java\lang\String.c</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token function">Java_java_lang_String_intern</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject this<span class="token punctuation">)</span>  
<span class="token punctuation">{</span>  
    <span class="token keyword">return</span> <span class="token function">JVM_InternString</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> this<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><p>\openjdk7\hotspot\src\share\vm\prims\jvm.h</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">/* 
* java.lang.String 
*/</span>  
JNIEXPORT jstring JNICALL  
<span class="token function">JVM_InternString</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jstring str<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>\openjdk7\hotspot\src\share\vm\prims\jvm.cpp</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">// String support ///////////////////////////////////////////////////////////////////////////  </span>
<span class="token function">JVM_ENTRY</span><span class="token punctuation">(</span>jstring<span class="token punctuation">,</span> <span class="token function">JVM_InternString</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jstring str<span class="token punctuation">)</span><span class="token punctuation">)</span>  
  <span class="token function">JVMWrapper</span><span class="token punctuation">(</span><span class="token string">&quot;JVM_InternString&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  JvmtiVMObjectAllocEventCollector oam<span class="token punctuation">;</span>  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>str <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>  
  oop string <span class="token operator">=</span> JNIHandles<span class="token operator">::</span><span class="token function">resolve_non_null</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  oop result <span class="token operator">=</span> StringTable<span class="token operator">::</span><span class="token function">intern</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> CHECK_NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>jstring<span class="token punctuation">)</span> JNIHandles<span class="token operator">::</span><span class="token function">make_local</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>  
JVM_END
</code></pre></div><p>\openjdk7\hotspot\src\share\vm\classfile\symbolTable.cpp</p> <div class="language-c extra-class"><pre class="language-c"><code>oop StringTable<span class="token operator">::</span><span class="token function">intern</span><span class="token punctuation">(</span>Handle string_or_null<span class="token punctuation">,</span> jchar<span class="token operator">*</span> name<span class="token punctuation">,</span>  
                        <span class="token keyword">int</span> len<span class="token punctuation">,</span> TRAPS<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> hashValue <span class="token operator">=</span> java_lang_String<span class="token operator">::</span><span class="token function">hash_string</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token function">the_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">hash_to_index</span><span class="token punctuation">(</span>hashValue<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  oop string <span class="token operator">=</span> <span class="token function">the_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">lookup</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> name<span class="token punctuation">,</span> len<span class="token punctuation">,</span> hashValue<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token comment">// Found  </span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>string <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token keyword">return</span> string<span class="token punctuation">;</span>  
  <span class="token comment">// Otherwise, add to symbol to table  </span>
  <span class="token keyword">return</span> <span class="token function">the_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">basic_add</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> string_or_null<span class="token punctuation">,</span> name<span class="token punctuation">,</span> len<span class="token punctuation">,</span>  
                                hashValue<span class="token punctuation">,</span> CHECK_NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><p>\openjdk7\hotspot\src\share\vm\classfile\symbolTable.cpp</p> <div class="language-c extra-class"><pre class="language-c"><code>oop StringTable<span class="token operator">::</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> jchar<span class="token operator">*</span> name<span class="token punctuation">,</span>  
                        <span class="token keyword">int</span> len<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">for</span> <span class="token punctuation">(</span>HashtableEntry<span class="token operator">&lt;</span>oop<span class="token operator">&gt;</span><span class="token operator">*</span> l <span class="token operator">=</span> <span class="token function">bucket</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span> l <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> l <span class="token operator">=</span> l<span class="token operator">-&gt;</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>l<span class="token operator">-&gt;</span><span class="token function">hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">if</span> <span class="token punctuation">(</span>java_lang_String<span class="token operator">::</span><span class="token function">equals</span><span class="token punctuation">(</span>l<span class="token operator">-&gt;</span><span class="token function">literal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token keyword">return</span> l<span class="token operator">-&gt;</span><span class="token function">literal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
  <span class="token punctuation">}</span>  
  <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><p>它的大体实现结构就是:
JAVA 使用 jni 调用c++实现的<code>StringTable</code>的<code>intern</code>方法, <code>StringTable</code>的<code>intern</code>方法跟Java中的<code>HashMap</code>的实现是差不多的, 只是不能自动扩容。默认大小是1009。</p> <p>要注意的是，String的String Pool是一个固定大小的<code>Hashtable</code>，默认值大小长度是1009，如果放进String Pool的String非常多，就会造成Hash冲突严重，从而导致链表会很长，而链表长了后直接会造成的影响就是当调用<code>String.intern</code>时性能会大幅下降（因为要一个一个找）。</p> <p>在 jdk6中<code>StringTable</code>是固定的，就是1009的长度，所以如果常量池中的字符串过多就会导致效率下降很快。在jdk7中，<code>StringTable</code>的长度可以通过一个参数指定：</p> <ul><li><code>-XX:StringTableSize=99991</code></li></ul> <h2 id="二-jdk6-和-jdk7-下-intern-的区别"><a href="#二-jdk6-和-jdk7-下-intern-的区别" class="header-anchor">#</a> 二，jdk6 和 jdk7 下 intern 的区别</h2> <p>相信很多 JAVA 程序员都做做类似 <code>String s = new String(&quot;abc&quot;)</code>这个语句创建了几个对象的题目。 这种题目主要就是为了考察程序员对字符串对象的常量池掌握与否。上述的语句中是创建了2个对象，第一个对象是&quot;abc&quot;字符串存储在常量池中，第二个对象在JAVA Heap中的 String 对象。</p> <p>来看一段代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    s<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    s3<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s4 <span class="token operator">=</span> <span class="token string">&quot;11&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>打印结果是</p> <ul><li>jdk6 下<code>false false</code></li> <li>jdk7 下<code>false true</code></li></ul> <p>具体为什么稍后再解释，然后将<code>s3.intern();</code>语句下调一行，放到<code>String s4 = &quot;11&quot;;</code>后面。将<code>s.intern();</code> 放到<code>String s2 = &quot;1&quot;;</code>后面。是什么结果呢？</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">;</span>
    s<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s4 <span class="token operator">=</span> <span class="token string">&quot;11&quot;</span><span class="token punctuation">;</span>
    s3<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>打印结果为：</p> <ul><li>jdk6 下<code>false false</code></li> <li>jdk7 下<code>false false</code></li></ul> <p>####1，jdk6中的解释</p> <img src="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/img/20181222/in-depth-understanding-string-intern/jdk6.png" alt="jdk6图"> <p>注：图中绿色线条代表 string 对象的内容指向。 黑色线条代表地址指向。</p> <p>如上图所示。首先说一下 jdk6中的情况，在 jdk6中上述的所有打印都是 false 的，因为 jdk6中的常量池是放在 Perm 区中的，Perm 区和正常的 JAVA Heap 区域是完全分开的。上面说过如果是使用引号声明的字符串都是会直接在字符串常量池中生成，而 new 出来的 String 对象是放在 JAVA Heap 区域。所以拿一个 JAVA Heap 区域的对象地址和字符串常量池的对象地址进行比较肯定是不相同的，即使调用<code>String.intern</code>方法也是没有任何关系的。</p> <p>####2，jdk7中的解释</p> <p>再说说 jdk7 中的情况。这里要明确一点的是，在 Jdk6 以及以前的版本中，字符串的常量池是放在堆的 Perm 区的，Perm 区是一个类静态的区域，主要存储一些加载类的信息，常量池，方法片段等内容，默认大小只有4m，一旦常量池中大量使用 intern 是会直接产生<code>java.lang.OutOfMemoryError: PermGen space</code>错误的。 所以在 jdk7 的版本中，字符串常量池已经从 Perm 区移到正常的 Java Heap 区域了。为什么要移动，Perm 区域太小是一个主要原因，当然据消息称 jdk8 已经直接取消了 Perm 区域，而新建立了一个元区域。应该是 jdk 开发者认为 Perm 区域已经不适合现在 JAVA 的发展了。</p> <p>正式因为字符串常量池移动到 JAVA Heap 区域后，再来解释为什么会有上述的打印结果。</p> <img src="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/img/20181222/in-depth-understanding-string-intern/jdk7-1.png" alt="jdk7图1"> <ul><li>在第一段代码中，先看 s3和s4字符串。<code>String s3 = new String(&quot;1&quot;) + new String(&quot;1&quot;);</code>，这句代码中现在生成了2最终个对象，是字符串常量池中的“1” 和 JAVA Heap 中的 s3引用指向的对象。中间还有2个匿名的<code>new String(&quot;1&quot;)</code>我们不去讨论它们。此时s3引用对象内容是&quot;11&quot;，但此时常量池中是没有 “11”对象的。</li> <li>接下来<code>s3.intern();</code>这一句代码，是将 s3中的“11”字符串放入 String 常量池中，因为此时常量池中不存在“11”字符串，因此常规做法是跟 jdk6 图中表示的那样，在常量池中生成一个 &quot;11&quot; 的对象，关键点是 jdk7 中常量池不在 Perm 区域了，这块做了调整。常量池中不需要再存储一份对象了，可以直接存储堆中的引用。这份引用指向 s3 引用的对象。 也就是说引用地址是相同的。</li> <li>最后<code>String s4 = &quot;11&quot;;</code> 这句代码中&quot;11&quot;是显示声明的，因此会直接去常量池中创建，创建的时候发现已经有这个对象了，此时也就是指向 s3 引用对象的一个引用。所以 s4 引用就指向和 s3 一样了。因此最后的比较 <code>s3 == s4</code> 是 true。</li> <li>再看 s 和 s2 对象。 <code>String s = new String(&quot;1&quot;);</code> 第一句代码，生成了2个对象。常量池中的“1” 和 JAVA Heap 中的字符串对象。<code>s.intern();</code> 这一句是 s 对象去常量池中寻找后发现 “1” 已经在常量池里了。</li> <li>接下来<code>String s2 = &quot;1&quot;;</code> 这句代码是生成一个 s2的引用指向常量池中的“1”对象。 结果就是 s 和 s2 的引用地址明显不同。图中画的很清晰。</li></ul> <img src="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/img/20181222/in-depth-understanding-string-intern/jdk7-2.png" alt="jdk7图2"> <ul><li>来看第二段代码，从上边第二幅图中观察。第一段代码和第二段代码的改变就是 <code>s3.intern();</code> 的顺序是放在<code>String s4 = &quot;11&quot;;</code>后了。这样，首先执行<code>String s4 = &quot;11&quot;;</code>声明 s4 的时候常量池中是不存在“11”对象的，执行完毕后，“11“对象是 s4 声明产生的新对象。然后再执行<code>s3.intern();</code>时，常量池中“11”对象已经存在了，因此 s3 和 s4 的引用是不同的。</li> <li>第二段代码中的 s 和 s2 代码中，<code>s.intern();</code>，这一句往后放也不会有什么影响了，因为对象池中在执行第一句代码<code>String s = new String(&quot;1&quot;);</code>的时候已经生成“1”对象了。下边的s2声明都是直接从常量池中取地址引用的。 s 和 s2 的引用地址是不会相等的。</li></ul> <p>####小结
从上述的例子代码可以看出 jdk7 版本对 intern 操作和常量池都做了一定的修改。主要包括2点：</p> <ul><li>将String常量池 从 Perm 区移动到了 Java Heap区</li> <li><code>String#intern</code> 方法时，如果存在堆中的对象，会直接保存对象的引用，而不会重新创建对象。</li></ul> <h2 id="三-使用-intern"><a href="#三-使用-intern" class="header-anchor">#</a> 三，使用 intern</h2> <h3 id="_1-intern-正确使用例子"><a href="#_1-intern-正确使用例子" class="header-anchor">#</a> 1,intern 正确使用例子</h3> <p>接下来我们来看一下一个比较常见的使用<code>String#intern</code>方法的例子。</p> <p>代码如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MAX <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>MAX<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> DB_DATA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> DB_DATA<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        DB_DATA<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">long</span> t <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAX<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//arr[i] = new String(String.valueOf(DB_DATA[i % DB_DATA.length]));</span>
         arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>DB_DATA<span class="token punctuation">[</span>i <span class="token operator">%</span> DB_DATA<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行的参数是：<code>-Xmx2g -Xms2g -Xmn1500M</code> 上述代码是一个演示代码，其中有两条语句不一样，一条是使用 intern，一条是未使用 intern。结果如下图</p> <p>2160ms</p> <img src="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/img/20181222/in-depth-understanding-string-intern/with-intern.png" alt="使用 intern"> <p>826ms</p> <img src="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/img/20181222/in-depth-understanding-string-intern/without-intern.png" alt="未使用 intern"> <p>通过上述结果，我们发现不使用 intern 的代码生成了1000w 个字符串，占用了大约640m 空间。 使用了 intern 的代码生成了1345个字符串，占用总空间 133k 左右。其实通过观察程序中只是用到了10个字符串，所以准确计算后应该是正好相差100w 倍。虽然例子有些极端，但确实能准确反应出 intern 使用后产生的巨大空间节省。</p> <p>细心的同学会发现使用了 intern 方法后时间上有了一些增长。这是因为程序中每次都是用了 <code>new String</code> 后，然后又进行 intern 操作的耗时时间，这一点如果在内存空间充足的情况下确实是无法避免的，但我们平时使用时，内存空间肯定不是无限大的，不使用 intern 占用空间导致 jvm 垃圾回收的时间是要远远大于这点时间的。 毕竟这里使用了1000w次intern 才多出来1秒钟多的时间。</p> <h3 id="_2-intern-不当使用"><a href="#_2-intern-不当使用" class="header-anchor">#</a> 2，intern 不当使用</h3> <p>看过了 intern 的使用和 intern 的原理等，我们来看一个不当使用 intern 操作导致的问题。</p> <p>在使用 fastjson 进行接口读取的时候，我们发现在读取了近70w条数据后，我们的日志打印变的非常缓慢，每打印一次日志用时30ms左右，如果在一个请求中打印2到3条日志以上会发现请求有一倍以上的耗时。在重新启动 jvm 后问题消失。继续读取接口后，问题又重现。接下来我们看一下出现问题的过程。</p> <p>####1，根据 log4j 打印日志查找问题原因</p> <p>在使用<code>log4j#info</code>打印日志的时候时间非常长。所以使用 housemd 软件跟踪 info 方法的耗时堆栈。</p> <ul><li>trace SLF4JLogger.</li> <li>trace AbstractLoggerWrapper:</li> <li>trace AsyncLogger</li></ul> <div class="language- extra-class"><pre class="language-text"><code>org/apache/logging/log4j/core/async/AsyncLogger.actualAsyncLog(RingBufferLogEvent)                sun.misc.Launcher$AppClassLoader@109aca82            1            1ms    org.apache.logging.log4j.core.async.AsyncLogger@19de86bb  
org/apache/logging/log4j/core/async/AsyncLogger.location(String)                                  sun.misc.Launcher$AppClassLoader@109aca82            1           30ms    org.apache.logging.log4j.core.async.AsyncLogger@19de86bb  
org/apache/logging/log4j/core/async/AsyncLogger.log(Marker, String, Level, Message, Throwable)    sun.misc.Launcher$AppClassLoader@109aca82            1           61ms    org.apache.logging.log4j.core.async.AsyncLogger@19de86bb
</code></pre></div><p>代码出在 <code>AsyncLogger.location</code> 这个方法上. 里边主要是调用了 <code>return Log4jLogEvent.calcLocation(fqcnOfLogger);</code>和<code>Log4jLogEvent.calcLocation()</code></p> <p><code>Log4jLogEvent.calcLocation()</code>的代码如下:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">StackTraceElement</span> <span class="token function">calcLocation</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> fqcnOfLogger<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fqcnOfLogger <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
    <span class="token keyword">final</span> <span class="token class-name">StackTraceElement</span><span class="token punctuation">[</span><span class="token punctuation">]</span> stackTrace <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">boolean</span> next <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">StackTraceElement</span> element <span class="token operator">:</span> stackTrace<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token keyword">final</span> <span class="token class-name">String</span> className <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            <span class="token keyword">if</span> <span class="token punctuation">(</span>fqcnOfLogger<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                <span class="token keyword">continue</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
            <span class="token keyword">return</span> element<span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fqcnOfLogger<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            next <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>NOT_AVAIL<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            <span class="token keyword">break</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><p>经过跟踪发现是 <code>Thread.currentThread().getStackTrace();</code> 的问题。</p> <p>####2, 跟踪Thread.currentThread().getStackTrace()的 native 代码，验证String#intern</p> <p><code>Thread.currentThread().getStackTrace();</code>native的方法:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">StackTraceElement</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token comment">// check for getStackTrace permission  </span>
        <span class="token class-name">SecurityManager</span> security <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>security <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            security<span class="token punctuation">.</span><span class="token function">checkPermission</span><span class="token punctuation">(</span>  
                <span class="token class-name">SecurityConstants</span><span class="token punctuation">.</span>GET_STACK_TRACE_PERMISSION<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
        <span class="token comment">// optimization so we do not call into the vm for threads that  </span>
        <span class="token comment">// have not yet started or have terminated  </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            <span class="token keyword">return</span> EMPTY_STACK_TRACE<span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>        <span class="token class-name">StackTraceElement</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> stackTraceArray <span class="token operator">=</span> <span class="token function">dumpThreads</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">StackTraceElement</span><span class="token punctuation">[</span><span class="token punctuation">]</span> stackTrace <span class="token operator">=</span> stackTraceArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
        <span class="token comment">// a thread that was alive during the previous isAlive call may have  </span>
        <span class="token comment">// since terminated, therefore not having a stacktrace.  </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>stackTrace <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            stackTrace <span class="token operator">=</span> EMPTY_STACK_TRACE<span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
        <span class="token keyword">return</span> stackTrace<span class="token punctuation">;</span>  
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  
        <span class="token comment">// Don't need JVM help for current thread  </span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  

<span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">static</span> <span class="token class-name">StackTraceElement</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">dumpThreads</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">[</span><span class="token punctuation">]</span> threads<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>下载 openJdk7的源码查询 jdk 的 native 实现代码，列表如下【这里因为篇幅问题，不详细罗列涉及到的代码，有兴趣的可以根据文件名称和行号查找相关代码】：</p> <p>\openjdk7\jdk\src\share\native\java\lang\Thread.c
\openjdk7\hotspot\src\share\vm\prims\jvm.h line:294:
\openjdk7\hotspot\src\share\vm\prims\jvm.cpp line:4382-4414:
\openjdk7\hotspot\src\share\vm\services\threadService.cpp line:235-267:
\openjdk7\hotspot\src\share\vm\services\threadService.cpp line:566-577:
\openjdk7\hotspot\src\share\vm\classfile\javaClasses.cpp line:1635-[1651,1654,1658]:</p> <p>完成跟踪了底层的 jvm 源码后发现，是下边的三条代码引发了整个程序的变慢问题。</p> <div class="language-c extra-class"><pre class="language-c"><code>oop classname <span class="token operator">=</span> StringTable<span class="token operator">::</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span> str<span class="token punctuation">,</span> CHECK_0<span class="token punctuation">)</span><span class="token punctuation">;</span>  
oop methodname <span class="token operator">=</span> StringTable<span class="token operator">::</span><span class="token function">intern</span><span class="token punctuation">(</span>method<span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CHECK_0<span class="token punctuation">)</span><span class="token punctuation">;</span>  
oop filename <span class="token operator">=</span> StringTable<span class="token operator">::</span><span class="token function">intern</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> CHECK_0<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这三段代码是获取类名、方法名、和文件名。因为类名、方法名、文件名都是存储在字符串常量池中的，所以每次获取它们都是通过<code>String#intern</code>方法。但没有考虑到的是默认的 StringPool 的长度是1009且不可变的。因此一旦常量池中的字符串达到的一定的规模后，性能会急剧下降。</p> <p>####3,fastjson 不当使用 String#intern</p> <p>导致这个 intern 变慢的原因是因为 fastjson 对<code>String#intern</code>方法的使用不当造成的。跟踪 fastjson 中的实现代码发现，</p> <p>####<code>com.alibaba.fastjson.parser.JSONScanner#scanFieldSymbol()</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">==</span> <span class="token char">'\&quot;'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    bp <span class="token operator">=</span> index<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ch <span class="token operator">=</span> ch <span class="token operator">=</span> buf<span class="token punctuation">[</span>bp<span class="token punctuation">]</span><span class="token punctuation">;</span>
    strVal <span class="token operator">=</span> symbolTable<span class="token punctuation">.</span><span class="token function">addSymbol</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> start<span class="token punctuation">,</span> index <span class="token operator">-</span> start <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>####<code>com.alibaba.fastjson.parser.SymbolTable#addSymbol()</code>:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * Constructs a new entry from the specified symbol information and next entry reference.
 */</span>
<span class="token keyword">public</span> <span class="token class-name">Entry</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ch<span class="token punctuation">,</span> <span class="token keyword">int</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">,</span> <span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">Entry</span> next<span class="token punctuation">)</span><span class="token punctuation">{</span>
    characters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> characters<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    symbol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>characters<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hashCode <span class="token operator">=</span> hash<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>bytes <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>fastjson 中对所有的 json 的 key 使用了 intern 方法，缓存到了字符串常量池中，这样每次读取的时候就会非常快，大大减少时间和空间。而且 json 的 key 通常都是不变的。这个地方没有考虑到大量的 json key 如果是变化的，那就会给字符串常量池带来很大的负担。</p> <p>这个问题 fastjson 在1.1.24版本中已经将这个漏洞修复了。程序加入了一个最大的缓存大小，超过这个大小后就不会再往字符串常量池中放了。</p> <p>[1.1.24版本的<code>com.alibaba.fastjson.parser.SymbolTable#addSymbol()</code> Line:113]代码</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MAX_SIZE           <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">&gt;=</span> MAX_SIZE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个问题是70w 数据量时候的引发的，如果是几百万的数据量的话可能就不只是30ms 的问题了。因此在使用系统级提供的<code>String#intern</code>方式一定要慎重！</p> <h2 id="五-总结"><a href="#五-总结" class="header-anchor">#</a> 五，总结</h2> <p>本文大体的描述了 <code>String#intern</code>和字符串常量池的日常使用，jdk 版本的变化和<code>String#intern</code>方法的区别，以及不恰当使用导致的危险等内容，让大家对系统级别的 <code>String#intern</code>有一个比较深入的认识。让我们在使用和接触它的时候能避免出现一些 bug，增强系统的健壮性。</p> <h2 id="引用"><a href="#引用" class="header-anchor">#</a> 引用：</h2> <p>以下是几个比较关键的几篇博文。感谢！</p> <ul><li><a href="https://blog.codecentric.de/en/2012/03/save-memory-by-using-string-intern-in-java/" target="_blank" rel="noopener noreferrer">Save Memory by Using String Intern in Java<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://stackoverflow.com/questions/921384/java-string-array-is-there-a-size-of-method" target="_blank" rel="noopener noreferrer">Java String array: is there a size of method?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://xmlandmore.blogspot.com/2013/05/understanding-string-table-size-in.html" target="_blank" rel="noopener noreferrer">Understanding String Table Size in HotSpot<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://stackoverflow.com/questions/3323608/how-is-javas-stringintern-method-implemented" target="_blank" rel="noopener noreferrer">How is Java's String#intern() method implemented?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://hellojava.info/?p=61" target="_blank" rel="noopener noreferrer">JDK7里的String.intern的变化<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <hr> <blockquote><p>此文转自<a href="https://tech.meituan.com/" target="_blank" rel="noopener noreferrer">美团技术团队<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，原文地址：<a href="https://tech.meituan.com/in_depth_understanding_string_intern.html" target="_blank" rel="noopener noreferrer">https://tech.meituan.com/in_depth_understanding_string_intern.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>（完）</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/hxulin/my-blog/edit/master/site/_posts/2018-12-22-in-depth-understanding-string-intern.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022-06-26 12:38:39</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/2018/12/29/rabbitmq-common-commands/" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        RabbitMQ常用命令总结
      </a></span> <span class="next"><a href="/2018/12/17/equals-hashcode-method/">
        Java 中的 equals() 和 hashCode() 方法
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/app.d0033b28.js" defer></script><script src="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/3.fef87ffa.js" defer></script><script src="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/4.1bcccd14.js" defer></script><script src="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/20.c035d260.js" defer></script><script src="https://cdn.jsdelivr.net/gh/hxulin/hxulin.github.io/assets/js/9.41320d8a.js" defer></script>
  </body>
</html>